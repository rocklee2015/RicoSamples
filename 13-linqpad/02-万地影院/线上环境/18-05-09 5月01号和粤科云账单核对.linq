<Query Kind="Statements">
  <Connection>
    <ID>edb569e0-1029-4670-bd56-f4981986d255</ID>
    <Persist>true</Persist>
    <Server>101.132.69.71</Server>
    <SqlSecurity>true</SqlSecurity>
    <UserName>sa</UserName>
    <Password>AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAABoybHsSXFUuz8AXaKmCqgAAAAAACAAAAAAAQZgAAAAEAACAAAADlMDTg8rh8stUlZgjvxKWfJkLaoJu5GrJnhua9EICUhQAAAAAOgAAAAAIAACAAAAB7x+0HnQ6b0YgF1diupbyFoqj8o5uo5sGeSJrsiKJKHBAAAABM8IUq4NDIt9vX4B4yLwcyQAAAAJFB1V+gp2sgHISifMpmzqEsGAOnWOnhx7O3RcsGhbmZYn41eVGBCO7ch97kncwveJgTFqk5lA+bm4awvliGAl0=</Password>
    <Database>CinemaWd</Database>
    <ShowServer>true</ShowServer>
  </Connection>
  <Output>DataGrids</Output>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Antlr3.Runtime.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Cinema.AppWeb.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Cinema.Audit.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Cinema.Caches.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Cinema.Core.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Cinema.SmsService.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Cinema.Util.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Cinema.YueKe.Service.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Domain.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Domain.Identity.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Storage.EntityFramework.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Storage.EntityFramework.Identity.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Thirdparty.Alipay.AppPay.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Thirdparty.Wechat.AppPay.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Utility.Configuration.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Utility.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Utility.Exceptional.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Utility.Http.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Utility.Logger.Ado.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Utility.Serialization.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Web.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\DRapid.Web.Identity.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\EntityFramework.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\EntityFramework.SqlServer.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.AspNet.Identity.Core.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.AspNet.Identity.Owin.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.CodeDom.Providers.DotNetCompilerPlatform.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Owin.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Owin.Host.SystemWeb.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Owin.Security.Cookies.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Owin.Security.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Owin.Security.OAuth.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Practices.ServiceLocation.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Practices.Unity.Configuration.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Practices.Unity.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Practices.Unity.Interception.Configuration.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Practices.Unity.Interception.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Practices.Unity.RegistrationByConvention.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Microsoft.Web.Infrastructure.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Newtonsoft.Json.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\Owin.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\StackExchange.Redis.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Net.Http.Extensions.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Net.Http.Formatting.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Net.Http.Primitives.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Web.Helpers.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Web.Http.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Web.Http.Owin.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Web.Mvc.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Web.Optimization.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Web.Razor.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Web.Webpages.Deployment.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Web.Webpages.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\System.Web.Webpages.Razor.dll</Reference>
  <Reference>D:\00-baitu-tfs\TFS-2013\Cinema\master\src\Cinema.AppWeb\bin\WebGrease.dll</Reference>
  <Namespace>Cinema.Core.Domain.Models.Values</Namespace>
</Query>

//3月09号订单

var bookingIdLists = new List<string>() {

"1185018043083273",
"1185018043084353",
"1185018043084785",
"1185018043084586",
"1185018050184947",
"1185018043084938",
"1185018043083809",
"1185018043083894",
"1185018043083976",
"1185018043084853",
"1185018050184947",
"1185018043084312",
"1185018043084321",
"1185018043084700",
"1185018043084854",
"1185018043083809",
"1185018043083894",
"1185018043084312",
"1185018043084481",
"1185018043084586",
"1185018050184947",
"1185018043083809",
"1185018043084056",
"1185018043084353",
"1185018043084888",
"1185018043084590",
"1185018043083273",
"1185018043083299",
"1185018043083841",
"1185018043084481",
"1185018043084785",
"1185018043084854",
"1185018043084938",
"1185018043083299",
"1185018043083976",
"1185018043084056",
"1185018043084481",
"1185018043084785",
"1185018043084854",
"1185018043084586",
"1185018043083299",
"1185018043084215",
"1185018043084215",
"1185018043084321",
"1185018043084835",
"1185018043084835",
"1185018043084888",
"1185018043084586",

};
bookingIdLists.Count.Dump();

//bookingIdLists.Add("1185018030943296");
var result = Orders.OrderByDescending(a => a.CreateTime)
.Where(a => (a.Status > (int)OrderStatus.NoPay && a.Status < (int)OrderStatus.Deleted)
 && a.CreateTime < DateTime.Parse("2018-05-02 06:00")
  && a.CreateTime > DateTime.Parse("2018-05-01 06:00")
  && a.PayType != (int)PayType.LeaguerPay
//&&bookingIdLists.Contains(a.BookingId)
)
.Take(100).ToList().Select(a => new
{
	创建时间 = a.CreateTime.ToString("yyyy-MM-dd HH:mm:ss"),
	状态 = ((OrderStatus)a.Status).ReadEnumDescription(),
	支付方式 = ((PayType)a.PayType).ReadEnumDescription(),
	粤科存在订单 = bookingIdLists.Contains(a.BookingId) ? "是" : "否",
	a.TicketCount,
	a.OldTotal,
	a.Total,
	a.CardTotal,
	a.ThirdPay,
	去除手续费 = a.ThirdPay - a.TicketCount * 1,
	a.Mobile,

	a.PayCardNum,
	a.BookingId,
	a.ConfirmationId,
	a.OrderCode,
	a.MerchantOrderId,
	a.ThirdpartyOrderId,
	a.LimitDiscountId,
	a.RedPacketId,
	a.GoodsTotal,
	a.TotalGoodsFee,
	a.PickUpCode,
	a.HoldId,
	a.Id,
	a.LockOrderId,
	a.OutLockId,

	
	a.ExpireTime,
	a.FilmScheduleId,
	a.PayType,
});
result.Dump("订单列表");

result.GroupBy(a => a.PayType).Select(a => new {
支付方式=((PayType)a.Key).ReadEnumDescription(),
应收总额=a.Sum(b=>b.ThirdPay),
总票数=a.Sum(b=>b.TicketCount),
}).Dump("各项支付汇总");